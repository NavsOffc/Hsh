<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoDAX - Platform Trading Kripto</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1e3a8a;
            --primary-light: #3b82f6;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1f2937;
            --light: #f8fafc;
            --gray: #6b7280;
            --border: #e5e7eb;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --primary: #1e40af;
            --primary-light: #60a5fa;
            --light: #111827;
            --dark: #f9fafb;
            --gray: #9ca3af;
            --border: #374151;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
            transition: var(--transition);
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background-color: var(--primary);
            color: white;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: 700;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            padding: 5px 10px;
            border-radius: 5px;
        }

        nav a:hover, nav a.active {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-family: 'Poppins', sans-serif;
        }

        .btn-primary {
            background-color: var(--primary-light);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary);
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid white;
            color: white;
        }

        .btn-outline:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .btn-success {
            background-color: var(--secondary);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        /* Main Content */
        .main-content {
            min-height: calc(100vh - 140px);
            padding: 30px 0;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .page-title {
            margin-bottom: 20px;
            font-size: 1.8rem;
            color: var(--primary);
        }

        /* Home Page */
        .hero-section {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 60px 0;
            text-align: center;
            border-radius: 15px;
            margin-bottom: 40px;
        }

        .hero-section h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .hero-section p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .crypto-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .crypto-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--border);
        }

        .crypto-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .crypto-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .crypto-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .crypto-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .crypto-symbol {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .crypto-price {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .crypto-change {
            display: flex;
            align-items: center;
            font-weight: 500;
        }

        .positive {
            color: var(--secondary);
        }

        .negative {
            color: var(--danger);
        }

        /* Table Styles */
        .table-container {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background-color: #f9fafb;
            font-weight: 600;
            color: var(--gray);
        }

        tr:hover {
            background-color: #f9fafb;
        }

        /* Auth Pages */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 70vh;
        }

        .auth-box {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: var(--shadow);
        }

        .auth-title {
            text-align: center;
            margin-bottom: 25px;
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 5px;
            font-family: 'Poppins', sans-serif;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .auth-link {
            text-align: center;
            margin-top: 20px;
        }

        .auth-link a {
            color: var(--primary-light);
            text-decoration: none;
        }

        .auth-link a:hover {
            text-decoration: underline;
        }

        /* Dashboard */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .card-title {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 10px;
        }

        .card-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .chart-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            height: 400px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        /* Wallet Page */
        .wallet-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .wallet-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .wallet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .wallet-actions {
            display: flex;
            gap: 10px;
        }

        /* Payment Gateway */
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .payment-method {
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .payment-method:hover, .payment-method.active {
            border-color: var(--primary-light);
            background-color: rgba(59, 130, 246, 0.05);
        }

        .payment-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .dana-color { color: #00d4d4; }
        .ovo-color { color: #4c2a85; }
        .gopay-color { color: #00aa13; }
        .bank-color { color: #1e3a8a; }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 100%;
            max-width: 500px;
            padding: 30px;
            box-shadow: var(--shadow);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        /* Processing Animation */
        .processing-animation {
            text-align: center;
            padding: 30px;
        }

        .processing-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-light);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Hidden Elements */
        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            nav ul {
                gap: 15px;
            }

            .crypto-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-cards, .wallet-cards {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-coins"></i>
                    <span>CryptoDAX</span>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" class="nav-link active" data-page="home">Beranda</a></li>
                        <li><a href="#" class="nav-link" data-page="market">Market</a></li>
                        <li><a href="#" class="nav-link hidden" data-page="dashboard" id="dashboardNav">Dashboard</a></li>
                        <li><a href="#" class="nav-link hidden" data-page="wallet" id="walletNav">Wallet</a></li>
                        <li><a href="#" class="nav-link hidden" data-page="profile" id="profileNav">Profil</a></li>
                    </ul>
                </nav>
                <div class="header-actions">
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="btn btn-outline" id="loginBtn">Login</button>
                    <button class="btn btn-primary" id="registerBtn">Daftar</button>
                    <button class="btn btn-outline hidden" id="logoutBtn">Logout</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container">
            <!-- Home Page -->
            <div id="home" class="page active">
                <div class="hero-section">
                    <h1>Selamat Datang di CryptoDAX</h1>
                    <p>Platform trading kripto terpercaya di Indonesia</p>
                    <button class="btn btn-primary" id="heroRegisterBtn">Mulai Trading Sekarang</button>
                </div>
                
                <h2 class="page-title">Harga Kripto Terkini</h2>
                <div class="crypto-grid" id="cryptoGrid"></div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Aset</th>
                                <th>Harga</th>
                                <th>24h</th>
                                <th>Volume</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="cryptoTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Market Page -->
            <div id="market" class="page">
                <h1 class="page-title">Market Kripto</h1>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Aset</th>
                                <th>Harga</th>
                                <th>24h</th>
                                <th>7d</th>
                                <th>Volume</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="marketTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Dashboard Page -->
            <div id="dashboard" class="page">
                <h1 class="page-title">Dashboard</h1>
                
                <div class="dashboard-cards">
                    <div class="dashboard-card">
                        <div class="card-title">Saldo Rupiah</div>
                        <div class="card-value" id="dashboardBalance">Rp 0</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-title">Total Aset</div>
                        <div class="card-value" id="dashboardAssets">Rp 0</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-title">Profit/Loss</div>
                        <div class="card-value" id="dashboardProfit">Rp 0</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="priceChart"></canvas>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-success" id="buyCryptoBtn">Beli Kripto</button>
                    <button class="btn btn-danger" id="sellCryptoBtn">Jual Kripto</button>
                </div>
                
                <h2>Portofolio Saya</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Aset</th>
                                <th>Jumlah</th>
                                <th>Harga Beli</th>
                                <th>Nilai Saat Ini</th>
                                <th>Profit/Loss</th>
                            </tr>
                        </thead>
                        <tbody id="portfolioTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Wallet Page -->
            <div id="wallet" class="page">
                <h1 class="page-title">Wallet & Saldo</h1>
                
                <div class="wallet-cards">
                    <div class="wallet-card">
                        <div class="wallet-header">
                            <div>
                                <div class="card-title">Saldo Rupiah</div>
                                <div class="card-value" id="idrBalance">Rp 0</div>
                            </div>
                            <div class="wallet-actions">
                                <button class="btn btn-primary" id="depositBtn">Deposit</button>
                                <button class="btn btn-outline" id="withdrawBtn">Withdraw</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h2>Aset Kripto Saya</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Aset</th>
                                <th>Jumlah</th>
                                <th>Nilai (IDR)</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="walletAssets"></tbody>
                    </table>
                </div>
                
                <h2>Riwayat Transaksi</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Tipe</th>
                                <th>Jumlah</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="transactionHistory"></tbody>
                    </table>
                </div>
            </div>

            <!-- Profile Page -->
            <div id="profile" class="page">
                <h1 class="page-title">Profil Pengguna</h1>
                <div class="dashboard-cards">
                    <div class="dashboard-card">
                        <div class="card-title">Total Investasi</div>
                        <div class="card-value" id="totalInvestment">Rp 0</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-title">Profit/Loss</div>
                        <div class="card-value" id="profitLoss">Rp 0</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-title">Aset Tersimpan</div>
                        <div class="card-value" id="totalAssets">0</div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" id="editProfileBtn">Edit Profil</button>
                    <button class="btn btn-danger" id="logoutBtnMain">Logout</button>
                </div>
            </div>

            <!-- Auth Pages -->
            <div id="login" class="page">
                <div class="auth-container">
                    <div class="auth-box">
                        <h2 class="auth-title">Login ke CryptoDAX</h2>
                        <form id="loginForm">
                            <div class="form-group">
                                <label for="loginEmail">Email</label>
                                <input type="email" id="loginEmail" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="loginPassword">Password</label>
                                <input type="password" id="loginPassword" class="form-control" required>
                            </div>
                            <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                        </form>
                        <div class="auth-link">
                            <p>Belum punya akun? <a href="#" id="showRegister">Daftar di sini</a></p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="register" class="page">
                <div class="auth-container">
                    <div class="auth-box">
                        <h2 class="auth-title">Daftar Akun CryptoDAX</h2>
                        <form id="registerForm">
                            <div class="form-group">
                                <label for="registerName">Nama Lengkap</label>
                                <input type="text" id="registerName" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="registerEmail">Email</label>
                                <input type="email" id="registerEmail" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="registerPassword">Password</label>
                                <input type="password" id="registerPassword" class="form-control" required minlength="6">
                            </div>
                            <div class="form-group">
                                <label for="registerConfirmPassword">Konfirmasi Password</label>
                                <input type="password" id="registerConfirmPassword" class="form-control" required>
                            </div>
                            <button type="submit" class="btn btn-primary" style="width: 100%;">Daftar</button>
                        </form>
                        <div class="auth-link">
                            <p>Sudah punya akun? <a href="#" id="showLogin">Login di sini</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="depositModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Deposit Rupiah</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="depositForm">
                <div class="form-group">
                    <label for="depositAmount">Jumlah Deposit (Min. Rp 10.000)</label>
                    <input type="number" id="depositAmount" class="form-control" min="10000" required>
                </div>
                
                <h4>Pilih Metode Pembayaran</h4>
                <div class="payment-methods">
                    <div class="payment-method" data-method="dana">
                        <div class="payment-icon dana-color"><i class="fas fa-mobile-alt"></i></div>
                        <div class="payment-name">DANA</div>
                    </div>
                    <div class="payment-method" data-method="ovo">
                        <div class="payment-icon ovo-color"><i class="fas fa-wallet"></i></div>
                        <div class="payment-name">OVO</div>
                    </div>
                    <div class="payment-method" data-method="gopay">
                        <div class="payment-icon gopay-color"><i class="fas fa-qrcode"></i></div>
                        <div class="payment-name">GoPay</div>
                    </div>
                    <div class="payment-method" data-method="bank">
                        <div class="payment-icon bank-color"><i class="fas fa-university"></i></div>
                        <div class="payment-name">Transfer Bank</div>
                    </div>
                </div>
                
                <div id="paymentInstructions" style="display: none; margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h5>Instruksi Pembayaran</h5>
                    <div id="instructionsContent"></div>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Lanjutkan Pembayaran</button>
            </form>
        </div>
    </div>

    <div class="modal" id="withdrawModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Withdraw Rupiah</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="withdrawForm">
                <div class="form-group">
                    <label for="withdrawAmount">Jumlah Withdraw (Min. Rp 50.000)</label>
                    <input type="number" id="withdrawAmount" class="form-control" min="50000" required>
                </div>
                
                <div class="form-group">
                    <label for="withdrawMethod">Metode Penarikan</label>
                    <select id="withdrawMethod" class="form-control" required>
                        <option value="">Pilih metode</option>
                        <option value="dana">DANA</option>
                        <option value="ovo">OVO</option>
                        <option value="gopay">GoPay</option>
                        <option value="bank">Transfer Bank</option>
                    </select>
                </div>
                
                <div class="form-group" id="accountNumberGroup" style="display: none;">
                    <label for="accountNumber">Nomor Telepon/Rekening</label>
                    <input type="text" id="accountNumber" class="form-control" placeholder="Masukkan nomor telepon atau rekening">
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">Proses Withdraw</button>
            </form>
        </div>
    </div>

    <div class="modal" id="buyCryptoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Beli Kripto</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="buyCryptoForm">
                <div class="form-group">
                    <label for="buyCryptoSelect">Pilih Kripto</label>
                    <select id="buyCryptoSelect" class="form-control" required></select>
                </div>
                <div class="form-group">
                    <label for="buyAmount">Jumlah (IDR)</label>
                    <input type="number" id="buyAmount" class="form-control" min="10000" required>
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">Beli</button>
            </form>
        </div>
    </div>

    <div class="modal" id="processingModal">
        <div class="modal-content">
            <div class="processing-animation">
                <div class="processing-spinner"></div>
                <h3>Memproses Transaksi</h3>
                <p id="processingMessage">Harap tunggu sebentar...</p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2023 CryptoDAX. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // ==================== DATABASE LOCALSTORAGE ====================
        class LocalDatabase {
            constructor() {
                this.dbName = 'cryptodax_db';
                this.init();
            }

            init() {
                if (!localStorage.getItem(this.dbName)) {
                    const initialData = {
                        users: [],
                        cryptoData: [
                            { symbol: 'BTC', name: 'Bitcoin', price: 520000000, change24h: 2.5, volume: 1250000000000, icon: '₿' },
                            { symbol: 'ETH', name: 'Ethereum', price: 28000000, change24h: -1.2, volume: 580000000000, icon: 'Ξ' },
                            { symbol: 'DOGE', name: 'Dogecoin', price: 1200, change24h: 5.8, volume: 12000000000, icon: 'Ð' },
                            { symbol: 'USDT', name: 'Tether', price: 15600, change24h: 0.1, volume: 4500000000000, icon: '₮' },
                            { symbol: 'SOL', name: 'Solana', price: 1200000, change24h: 3.4, volume: 35000000000, icon: 'S' },
                            { symbol: 'XRP', name: 'Ripple', price: 8500, change24h: -0.8, volume: 28000000000, icon: 'X' }
                        ],
                        transactions: [],
                        paymentMethods: [
                            {
                                id: 'dana',
                                name: 'DANA',
                                type: 'ewallet',
                                instructions: '1. Buka aplikasi DANA\n2. Pilih "Kirim"\n3. Masukkan nomor: 081234567890\n4. Masukkan jumlah deposit\n5. Konfirmasi pembayaran'
                            },
                            {
                                id: 'ovo',
                                name: 'OVO', 
                                type: 'ewallet',
                                instructions: '1. Buka aplikasi OVO\n2. Pilih "Transfer"\n3. Masukkan nomor: 081234567890\n4. Masukkan jumlah deposit\n5. Konfirmasi pembayaran'
                            },
                            {
                                id: 'gopay',
                                name: 'GoPay',
                                type: 'ewallet',
                                instructions: '1. Buka aplikasi Gojek\n2. Pilih "Bayar"\n3. Scan QR code berikut\n4. Masukkan jumlah deposit\n5. Konfirmasi pembayaran'
                            },
                            {
                                id: 'bank',
                                name: 'Transfer Bank',
                                type: 'bank',
                                instructions: '1. Buka aplikasi bank/mobile banking\n2. Pilih "Transfer"\n3. Masukkan rekening: 1234567890 (BCA)\n4. Atas nama: CRYPTODAX INDONESIA\n5. Masukkan jumlah deposit'
                            }
                        ]
                    };
                    this.save(initialData);
                }
            }

            get(key) {
                const data = JSON.parse(localStorage.getItem(this.dbName) || '{}');
                return key ? data[key] : data;
            }

            set(key, value) {
                const data = this.get();
                data[key] = value;
                this.save(data);
            }

            save(data) {
                localStorage.setItem(this.dbName, JSON.stringify(data));
            }

            addUser(user) {
                const users = this.get('users');
                users.push(user);
                this.set('users', users);
                
                // Initialize user data
                this.set(`user_${user.id}`, {
                    balance: 0,
                    assets: {},
                    transactions: [],
                    profile: user
                });
            }

            getUser(userId) {
                return this.get(`user_${userId}`);
            }

            updateUser(userId, data) {
                this.set(`user_${userId}`, data);
            }

            addTransaction(transaction) {
                const transactions = this.get('transactions');
                transactions.push(transaction);
                this.set('transactions', transactions);
            }

            updateCryptoData(data) {
                this.set('cryptoData', data);
            }

            getCryptoData() {
                return this.get('cryptoData');
            }

            getPaymentMethods() {
                return this.get('paymentMethods');
            }
        }

        // ==================== APPLICATION STATE ====================
        const appState = {
            currentUser: null,
            cryptoData: [],
            userData: {
                balance: 0,
                assets: {},
                transactions: []
            },
            theme: 'light',
            selectedPaymentMethod: null
        };

        // Initialize database
        const db = new LocalDatabase();

        // ==================== DOM ELEMENTS ====================
        const pages = document.querySelectorAll('.page');
        const navLinks = document.querySelectorAll('.nav-link');
        const themeToggle = document.getElementById('themeToggle');
        const loginBtn = document.getElementById('loginBtn');
        const registerBtn = document.getElementById('registerBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const logoutBtnMain = document.getElementById('logoutBtnMain');
        const showLogin = document.getElementById('showLogin');
        const showRegister = document.getElementById('showRegister');
        const heroRegisterBtn = document.getElementById('heroRegisterBtn');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const depositBtn = document.getElementById('depositBtn');
        const withdrawBtn = document.getElementById('withdrawBtn');
        const buyCryptoBtn = document.getElementById('buyCryptoBtn');
        const sellCryptoBtn = document.getElementById('sellCryptoBtn');
        const editProfileBtn = document.getElementById('editProfileBtn');
        
        // Navigation elements to show/hide
        const dashboardNav = document.getElementById('dashboardNav');
        const walletNav = document.getElementById('walletNav');
        const profileNav = document.getElementById('profileNav');

        // Modals
        const depositModal = document.getElementById('depositModal');
        const withdrawModal = document.getElementById('withdrawModal');
        const buyCryptoModal = document.getElementById('buyCryptoModal');
        const processingModal = document.getElementById('processingModal');
        const closeModals = document.querySelectorAll('.close-modal');

        // Forms
        const depositForm = document.getElementById('depositForm');
        const withdrawForm = document.getElementById('withdrawForm');
        const buyCryptoForm = document.getElementById('buyCryptoForm');
        const withdrawMethod = document.getElementById('withdrawMethod');
        const accountNumberGroup = document.getElementById('accountNumberGroup');
        const accountNumber = document.getElementById('accountNumber');
        const paymentInstructions = document.getElementById('paymentInstructions');
        const instructionsContent = document.getElementById('instructionsContent');
        const processingMessage = document.getElementById('processingMessage');

        // Display elements
        const cryptoGrid = document.getElementById('cryptoGrid');
        const cryptoTable = document.getElementById('cryptoTable');
        const marketTable = document.getElementById('marketTable');
        const walletAssets = document.getElementById('walletAssets');
        const transactionHistory = document.getElementById('transactionHistory');
        const idrBalance = document.getElementById('idrBalance');
        const dashboardBalance = document.getElementById('dashboardBalance');
        const dashboardAssets = document.getElementById('dashboardAssets');
        const dashboardProfit = document.getElementById('dashboardProfit');
        const portfolioTable = document.getElementById('portfolioTable');
        const buyCryptoSelect = document.getElementById('buyCryptoSelect');
        const priceChartCanvas = document.getElementById('priceChart');

        // ==================== INITIALIZATION ====================
        function initApp() {
            // Load theme
            const savedTheme = localStorage.getItem('cryptodax-theme');
            if (savedTheme) {
                appState.theme = savedTheme;
                document.body.setAttribute('data-theme', appState.theme);
                updateThemeToggleIcon();
            }

            // Load user data
            const savedUser = localStorage.getItem('cryptodax-user');
            if (savedUser) {
                appState.currentUser = JSON.parse(savedUser);
                loadUserData();
                showDashboard();
                updateNavigationForUser();
            } else {
                showHomePage();
                updateNavigationForGuest();
            }

            // Load crypto data
            appState.cryptoData = db.getCryptoData();
            updateCryptoDisplay();

            // Setup event listeners
            setupEventListeners();

            // Start price updates
            startPriceUpdates();

            // Initialize chart
            initChart();
        }

        // ==================== EVENT LISTENERS ====================
        function setupEventListeners() {
            // Navigation
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = e.target.getAttribute('data-page');
                    showPage(page);
                    
                    navLinks.forEach(nav => nav.classList.remove('active'));
                    e.target.classList.add('active');
                });
            });

            // Auth buttons
            loginBtn.addEventListener('click', () => showPage('login'));
            registerBtn.addEventListener('click', () => showPage('register'));
            heroRegisterBtn.addEventListener('click', () => showPage('register'));
            showLogin.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('login');
            });
            showRegister.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('register');
            });

            // Auth forms
            loginForm.addEventListener('submit', handleLogin);
            registerForm.addEventListener('submit', handleRegister);
            logoutBtn.addEventListener('click', handleLogout);
            logoutBtnMain.addEventListener('click', handleLogout);

            // Wallet actions
            depositBtn.addEventListener('click', () => showModal(depositModal));
            withdrawBtn.addEventListener('click', () => showModal(withdrawModal));
            depositForm.addEventListener('submit', handleDeposit);
            withdrawForm.addEventListener('submit', handleWithdraw);

            // Trade actions
            buyCryptoBtn.addEventListener('click', () => {
                populateCryptoSelect(buyCryptoSelect);
                showModal(buyCryptoModal);
            });
            sellCryptoBtn.addEventListener('click', () => {
                populateCryptoSelect(sellCryptoSelect, true);
                showModal(sellCryptoModal);
            });
            buyCryptoForm.addEventListener('submit', handleBuyCrypto);

            // Payment method selection
            document.querySelectorAll('.payment-method').forEach(method => {
                method.addEventListener('click', (e) => {
                    document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('active'));
                    method.classList.add('active');
                    
                    const methodId = method.getAttribute('data-method');
                    const paymentMethods = db.getPaymentMethods();
                    const selectedMethod = paymentMethods.find(m => m.id === methodId);
                    
                    if (selectedMethod) {
                        appState.selectedPaymentMethod = selectedMethod;
                        instructionsContent.textContent = selectedMethod.instructions;
                        paymentInstructions.style.display = 'block';
                    }
                });
            });

            // Withdraw method change
            withdrawMethod.addEventListener('change', () => {
                accountNumberGroup.style.display = withdrawMethod.value ? 'block' : 'none';
            });

            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);

            // Close modals
            closeModals.forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.classList.remove('active');
                    });
                });
            });

            // Close modal on outside click
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    e.target.classList.remove('active');
                }
            });
        }

        // ==================== PAGE NAVIGATION ====================
        function showPage(pageId) {
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        function showHomePage() {
            showPage('home');
        }

        function showDashboard() {
            showPage('dashboard');
            updateDashboard();
        }

        function updateNavigationForUser() {
            // Show user-specific navigation
            dashboardNav.classList.remove('hidden');
            walletNav.classList.remove('hidden');
            profileNav.classList.remove('hidden');
            logoutBtn.classList.remove('hidden');
            
            // Hide auth buttons
            loginBtn.classList.add('hidden');
            registerBtn.classList.add('hidden');
        }

        function updateNavigationForGuest() {
            // Hide user-specific navigation
            dashboardNav.classList.add('hidden');
            walletNav.classList.add('hidden');
            profileNav.classList.add('hidden');
            logoutBtn.classList.add('hidden');
            
            // Show auth buttons
            loginBtn.classList.remove('hidden');
            registerBtn.classList.remove('hidden');
        }

        // ==================== AUTHENTICATION ====================
        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                alert('Email dan password harus diisi');
                return;
            }

            const users = db.get('users');
            const user = users.find(u => u.email === email && u.password === password);

            if (user) {
                appState.currentUser = user;
                localStorage.setItem('cryptodax-user', JSON.stringify(user));
                loadUserData();
                showDashboard();
                updateNavigationForUser();
                alert('Login berhasil!');
            } else {
                alert('Email atau password salah');
            }
        }

        function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;

            if (!name || !email || !password || !confirmPassword) {
                alert('Semua field harus diisi');
                return;
            }

            if (password.length < 6) {
                alert('Password harus minimal 6 karakter');
                return;
            }

            if (password !== confirmPassword) {
                alert('Password dan konfirmasi password tidak cocok');
                return;
            }

            const users = db.get('users');
            if (users.find(u => u.email === email)) {
                alert('Email sudah terdaftar');
                return;
            }

            const newUser = {
                id: Date.now(),
                name,
                email,
                password,
                balance: 100000, // Saldo awal
                assets: {},
                transactions: []
            };

            db.addUser(newUser);
            appState.currentUser = newUser;
            localStorage.setItem('cryptodax-user', JSON.stringify(newUser));
            loadUserData();
            showDashboard();
            updateNavigationForUser();
            alert('Pendaftaran berhasil! Anda mendapatkan saldo awal Rp 100.000');
        }

        function handleLogout() {
            appState.currentUser = null;
            localStorage.removeItem('cryptodax-user');
            showHomePage();
            updateNavigationForGuest();
            alert('Logout berhasil');
        }

        // ==================== USER DATA MANAGEMENT ====================
        function loadUserData() {
            if (!appState.currentUser) return;
            
            const userData = db.getUser(appState.currentUser.id);
            if (userData) {
                appState.userData = userData;
            }
        }

        function saveUserData() {
            if (!appState.currentUser) return;
            db.updateUser(appState.currentUser.id, appState.userData);
        }

        // ==================== WALLET FUNCTIONS ====================
        function handleDeposit(e) {
            e.preventDefault();
            const amount = parseInt(document.getElementById('depositAmount').value);

            if (amount < 10000) {
                alert('Minimal deposit adalah Rp 10.000');
                return;
            }

            if (!appState.selectedPaymentMethod) {
                alert('Pilih metode pembayaran terlebih dahulu');
                return;
            }

            showModal(processingModal);
            processingMessage.textContent = `Memproses deposit Rp ${formatCurrency(amount)} via ${appState.selectedPaymentMethod.name}...`;

            setTimeout(() => {
                appState.userData.balance += amount;
                
                const transaction = {
                    id: Date.now(),
                    type: 'deposit',
                    amount,
                    method: appState.selectedPaymentMethod.id,
                    date: new Date().toISOString(),
                    status: 'completed'
                };
                
                appState.userData.transactions.push(transaction);
                db.addTransaction(transaction);

                saveUserData();
                updateWalletDisplay();
                updateDashboard();
                
                processingModal.classList.remove('active');
                depositModal.classList.remove('active');
                alert(`Deposit berhasil! Saldo Anda: Rp ${formatCurrency(appState.userData.balance)}`);
            }, 3000);
        }

        function handleWithdraw(e) {
            e.preventDefault();
            const amount = parseInt(document.getElementById('withdrawAmount').value);
            const method = withdrawMethod.value;
            const account = accountNumber.value;

            if (amount < 50000) {
                alert('Minimal withdraw adalah Rp 50.000');
                return;
            }

            if (amount > appState.userData.balance) {
                alert('Saldo tidak mencukupi');
                return;
            }

            if (!method) {
                alert('Pilih metode penarikan');
                return;
            }

            if (!account) {
                alert('Masukkan nomor telepon/rekening');
                return;
            }

            showModal(processingModal);
            processingMessage.textContent = `Memproses withdraw Rp ${formatCurrency(amount)} ke ${method}...`;

            setTimeout(() => {
                appState.userData.balance -= amount;
                
                const transaction = {
                    id: Date.now(),
                    type: 'withdraw',
                    amount,
                    method,
                    account,
                    date: new Date().toISOString(),
                    status: 'completed'
                };
                
                appState.userData.transactions.push(transaction);
                db.addTransaction(transaction);

                saveUserData();
                updateWalletDisplay();
                updateDashboard();
                
                processingModal.classList.remove('active');
                withdrawModal.classList.remove('active');
                alert(`Withdraw berhasil! Saldo Anda: Rp ${formatCurrency(appState.userData.balance)}`);
            }, 3000);
        }

        // ==================== TRADING FUNCTIONS ====================
        function handleBuyCrypto(e) {
            e.preventDefault();
            const crypto = document.getElementById('buyCryptoSelect').value;
            const amount = parseInt(document.getElementById('buyAmount').value);

            if (amount < 10000) {
                alert('Minimal pembelian Rp 10.000');
                return;
            }

            if (amount > appState.userData.balance) {
                alert('Saldo tidak mencukupi');
                return;
            }

            const cryptoData = appState.cryptoData.find(c => c.symbol === crypto);
            const cryptoAmount = amount / cryptoData.price;

            showModal(processingModal);
            processingMessage.textContent = `Memproses pembelian ${crypto}...`;

            // Simulate processing delay
            setTimeout(() => {
                appState.userData.balance -= amount;
                
                if (!appState.userData.assets[crypto]) {
                    appState.userData.assets[crypto] = { amount: 0, totalSpent: 0 };
                }
                
                appState.userData.assets[crypto].amount += cryptoAmount;
                appState.userData.assets[crypto].totalSpent += amount;

                const transaction = {
                    id: Date.now(),
                    type: 'buy',
                    crypto,
                    amount: cryptoAmount,
                    price: cryptoData.price,
                    total: amount,
                    date: new Date().toISOString()
                };
                
                appState.userData.transactions.push(transaction);
                db.addTransaction(transaction);

                saveUserData();
                updateWalletDisplay();
                updateDashboard();
                
                processingModal.classList.remove('active');
                buyCryptoModal.classList.remove('active');
                alert(`Pembelian ${crypto} berhasil!`);
            }, 2000);
        }

        // ==================== DISPLAY FUNCTIONS ====================
        function updateCryptoDisplay() {
            updateCryptoGrid();
            updateCryptoTable();
            updateMarketTable();
        }

        function updateCryptoGrid() {
            cryptoGrid.innerHTML = '';
            
            appState.cryptoData.forEach(crypto => {
                const changeClass = crypto.change24h >= 0 ? 'positive' : 'negative';
                const changeIcon = crypto.change24h >= 0 ? '▲' : '▼';
                
                const card = document.createElement('div');
                card.className = 'crypto-card';
                card.innerHTML = `
                    <div class="crypto-header">
                        <div class="crypto-icon">${crypto.icon}</div>
                        <div>
                            <div class="crypto-name">${crypto.name}</div>
                            <div class="crypto-symbol">${crypto.symbol}</div>
                        </div>
                    </div>
                    <div class="crypto-price">Rp ${formatCurrency(crypto.price)}</div>
                    <div class="crypto-change ${changeClass}">
                        ${changeIcon} ${Math.abs(crypto.change24h).toFixed(2)}%
                    </div>
                `;
                cryptoGrid.appendChild(card);
            });
        }

        function updateCryptoTable() {
            cryptoTable.innerHTML = '';
            
            appState.cryptoData.forEach(crypto => {
                const changeClass = crypto.change24h >= 0 ? 'positive' : 'negative';
                const changeIcon = crypto.change24h >= 0 ? '▲' : '▼';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center;">
                            <div class="crypto-icon" style="margin-right: 10px;">${crypto.icon}</div>
                            <div>
                                <div style="font-weight: 600;">${crypto.symbol}</div>
                                <div style="font-size: 0.8rem; color: var(--gray);">${crypto.name}</div>
                            </div>
                        </div>
                    </td>
                    <td>Rp ${formatCurrency(crypto.price)}</td>
                    <td class="${changeClass}">${changeIcon} ${Math.abs(crypto.change24h).toFixed(2)}%</td>
                    <td>Rp ${formatCurrency(crypto.volume)}</td>
                    <td><button class="btn btn-primary" data-symbol="${crypto.symbol}">Trade</button></td>
                `;
                cryptoTable.appendChild(row);
            });

            // Add trade button listeners
            document.querySelectorAll('#cryptoTable .btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (!appState.currentUser) {
                        showPage('login');
                        return;
                    }
                    const symbol = btn.getAttribute('data-symbol');
                    populateCryptoSelect(buyCryptoSelect, false, symbol);
                    showModal(buyCryptoModal);
                });
            });
        }

        function updateMarketTable() {
            marketTable.innerHTML = '';
            
            const marketData = [...appState.cryptoData];
            marketData.push(
                { symbol: 'ADA', name: 'Cardano', price: 4500, change24h: 1.2, change7d: 3.5, volume: 15000000000, icon: 'A' },
                { symbol: 'DOT', name: 'Polkadot', price: 65000, change24h: -2.1, change7d: 1.8, volume: 9000000000, icon: 'D' }
            );
            
            marketData.forEach(crypto => {
                const change24hClass = crypto.change24h >= 0 ? 'positive' : 'negative';
                const change24hIcon = crypto.change24h >= 0 ? '▲' : '▼';
                const change7d = crypto.change7d !== undefined ? crypto.change7d : (crypto.change24h + (Math.random() * 4 - 2));
                const change7dClass = change7d >= 0 ? 'positive' : 'negative';
                const change7dIcon = change7d >= 0 ? '▲' : '▼';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center;">
                            <div class="crypto-icon" style="margin-right: 10px;">${crypto.icon}</div>
                            <div>
                                <div style="font-weight: 600;">${crypto.symbol}</div>
                                <div style="font-size: 0.8rem; color: var(--gray);">${crypto.name}</div>
                            </div>
                        </div>
                    </td>
                    <td>Rp ${formatCurrency(crypto.price)}</td>
                    <td class="${change24hClass}">${change24hIcon} ${Math.abs(crypto.change24h).toFixed(2)}%</td>
                    <td class="${change7dClass}">${change7dIcon} ${Math.abs(change7d).toFixed(2)}%</td>
                    <td>Rp ${formatCurrency(crypto.volume)}</td>
                    <td><button class="btn btn-primary" data-symbol="${crypto.symbol}">Trade</button></td>
                `;
                marketTable.appendChild(row);
            });

            document.querySelectorAll('#marketTable .btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (!appState.currentUser) {
                        showPage('login');
                        return;
                    }
                    const symbol = btn.getAttribute('data-symbol');
                    populateCryptoSelect(buyCryptoSelect, false, symbol);
                    showModal(buyCryptoModal);
                });
            });
        }

        function updateDashboard() {
            if (!appState.currentUser) return;
            
            dashboardBalance.textContent = `Rp ${formatCurrency(appState.userData.balance)}`;
            
            let totalAssetsValue = 0;
            let totalSpent = 0;
            
            Object.keys(appState.userData.assets).forEach(symbol => {
                const crypto = appState.cryptoData.find(c => c.symbol === symbol);
                if (crypto) {
                    totalAssetsValue += appState.userData.assets[symbol].amount * crypto.price;
                    totalSpent += appState.userData.assets[symbol].totalSpent;
                }
            });
            
            dashboardAssets.textContent = `Rp ${formatCurrency(totalAssetsValue)}`;
            const profitLoss = totalAssetsValue - totalSpent;
            dashboardProfit.textContent = `Rp ${formatCurrency(profitLoss)}`;
            
            updatePortfolioTable();
        }

        function updatePortfolioTable() {
            portfolioTable.innerHTML = '';
            
            Object.keys(appState.userData.assets).forEach(symbol => {
                const asset = appState.userData.assets[symbol];
                const crypto = appState.cryptoData.find(c => c.symbol === symbol);
                
                if (crypto) {
                    const currentValue = asset.amount * crypto.price;
                    const profitLoss = currentValue - asset.totalSpent;
                    const profitLossPercent = (profitLoss / asset.totalSpent) * 100;
                    const profitLossClass = profitLoss >= 0 ? 'positive' : 'negative';
                    const profitLossIcon = profitLoss >= 0 ? '▲' : '▼';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div style="display: flex; align-items: center;">
                                <div class="crypto-icon" style="margin-right: 10px;">${crypto.icon}</div>
                                <div>
                                    <div style="font-weight: 600;">${crypto.symbol}</div>
                                    <div style="font-size: 0.8rem; color: var(--gray);">${crypto.name}</div>
                                </div>
                            </div>
                        </td>
                        <td>${asset.amount.toFixed(4)}</td>
                        <td>Rp ${formatCurrency(asset.totalSpent / asset.amount)}</td>
                        <td>Rp ${formatCurrency(currentValue)}</td>
                        <td class="${profitLossClass}">
                            ${profitLossIcon} Rp ${formatCurrency(Math.abs(profitLoss))} (${Math.abs(profitLossPercent).toFixed(2)}%)
                        </td>
                    `;
                    portfolioTable.appendChild(row);
                }
            });
            
            if (portfolioTable.children.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="5" style="text-align: center; padding: 30px; color: var(--gray);">
                        Anda belum memiliki aset kripto.
                    </td>
                `;
                portfolioTable.appendChild(row);
            }
        }

        function updateWalletDisplay() {
            if (!appState.currentUser) return;
            
            idrBalance.textContent = `Rp ${formatCurrency(appState.userData.balance)}`;
            updateWalletAssets();
            updateTransactionHistory();
        }

        function updateWalletAssets() {
            walletAssets.innerHTML = '';
            
            Object.keys(appState.userData.assets).forEach(symbol => {
                const asset = appState.userData.assets[symbol];
                const crypto = appState.cryptoData.find(c => c.symbol === symbol);
                
                if (crypto) {
                    const currentValue = asset.amount * crypto.price;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div style="display: flex; align-items: center;">
                                <div class="crypto-icon" style="margin-right: 10px;">${crypto.icon}</div>
                                <div>
                                    <div style="font-weight: 600;">${crypto.symbol}</div>
                                    <div style="font-size: 0.8rem; color: var(--gray);">${crypto.name}</div>
                                </div>
                            </div>
                        </td>
                        <td>${asset.amount.toFixed(4)}</td>
                        <td>Rp ${formatCurrency(currentValue)}</td>
                        <td>
                            <button class="btn btn-primary" data-symbol="${crypto.symbol}">Trade</button>
                        </td>
                    `;
                    walletAssets.appendChild(row);
                }
            });
            
            if (walletAssets.children.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="4" style="text-align: center; padding: 30px; color: var(--gray);">
                        Anda belum memiliki aset kripto.
                    </td>
                `;
                walletAssets.appendChild(row);
            }
        }

        function updateTransactionHistory() {
            transactionHistory.innerHTML = '';
            
            const recentTransactions = appState.userData.transactions
                .slice(-10)
                .reverse();
            
            recentTransactions.forEach(transaction => {
                const date = new Date(transaction.date).toLocaleDateString('id-ID');
                let typeText = '';
                let amountText = '';
                
                switch (transaction.type) {
                    case 'deposit':
                        typeText = 'Deposit';
                        amountText = `+ Rp ${formatCurrency(transaction.amount)}`;
                        break;
                    case 'withdraw':
                        typeText = 'Withdraw';
                        amountText = `- Rp ${formatCurrency(transaction.amount)}`;
                        break;
                    case 'buy':
                        typeText = `Beli ${transaction.crypto}`;
                        amountText = `- Rp ${formatCurrency(transaction.total)}`;
                        break;
                    case 'sell':
                        typeText = `Jual ${transaction.crypto}`;
                        amountText = `+ Rp ${formatCurrency(transaction.total)}`;
                        break;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${date}</td>
                    <td>${typeText}</td>
                    <td>${amountText}</td>
                    <td>Selesai</td>
                `;
                transactionHistory.appendChild(row);
            });
            
            if (transactionHistory.children.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="4" style="text-align: center; padding: 30px; color: var(--gray);">
                        Belum ada transaksi.
                    </td>
                `;
                transactionHistory.appendChild(row);
            }
        }

        // ==================== UTILITY FUNCTIONS ====================
        function showModal(modal) {
            modal.classList.add('active');
        }

        function populateCryptoSelect(selectElement, onlyOwned = false, preselected = null) {
            selectElement.innerHTML = '';
            
            let options = onlyOwned ? 
                Object.keys(appState.userData.assets).map(symbol => {
                    return appState.cryptoData.find(c => c.symbol === symbol);
                }).filter(Boolean) : [...appState.cryptoData];
            
            options.forEach(crypto => {
                const option = document.createElement('option');
                option.value = crypto.symbol;
                option.textContent = `${crypto.symbol} - ${crypto.name}`;
                selectElement.appendChild(option);
            });
            
            if (preselected) {
                selectElement.value = preselected;
            }
        }

        function toggleTheme() {
            appState.theme = appState.theme === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', appState.theme);
            localStorage.setItem('cryptodax-theme', appState.theme);
            updateThemeToggleIcon();
        }

        function updateThemeToggleIcon() {
            const icon = themeToggle.querySelector('i');
            icon.className = appState.theme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID').format(amount);
        }

        // ==================== PRICE UPDATES ====================
        function startPriceUpdates() {
            setInterval(() => {
                appState.cryptoData.forEach(crypto => {
                    const change = (Math.random() * 4 - 2);
                    crypto.price = Math.max(1, crypto.price * (1 + change / 100));
                    crypto.change24h = change;
                    crypto.volume = crypto.volume * (1 + (Math.random() * 10 - 5) / 100);
                });
                
                db.updateCryptoData(appState.cryptoData);
                updateCryptoDisplay();
                
                if (appState.currentUser) {
                    updateDashboard();
                    updateWalletDisplay();
                }
            }, 5000);
        }

        // ==================== CHART INITIALIZATION ====================
        function initChart() {
            const ctx = priceChartCanvas.getContext('2d');
            
            const labels = [];
            const data = [];
            let currentPrice = 520000000;
            
            for (let i = 0; i < 24; i++) {
                labels.push(`${i}:00`);
                currentPrice = currentPrice * (1 + (Math.random() * 2 - 1) / 100);
                data.push(currentPrice);
            }
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Harga Bitcoin (IDR)',
                        data: data,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return `Rp ${formatCurrency(context.parsed.y)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: { grid: { display: false } },
                        y: {
                            grid: { color: 'rgba(0, 0, 0, 0.1)' },
                            ticks: {
                                callback: function(value) {
                                    return 'Rp ' + formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        // ==================== INITIALIZE APP ====================
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
